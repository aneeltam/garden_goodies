<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AJAX Message</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/pure-min.css"> <!-- Pure.css -->
    <link rel="stylesheet" href="styles.css"> <!-- Your custom styles -->
</head>
<body class="ajaxmessage-body">
    <div id="ajaxFormContainer">
        <h1>Submit a Message via AJAX</h1>
        <form id="ajaxForm" class="pure-form pure-form-aligned">
            <fieldset>
                <div class="pure-control-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" placeholder="Username" required>
                </div>
                <div class="pure-control-group">
                    <label for="country">Country</label>
                    <input type="text" id="country" placeholder="Country" required>
                </div>
                <div class="pure-control-group">
                    <label for="message">Message</label>
                    <textarea id="message" placeholder="Your message" required></textarea>
                </div>
                <div class="pure-controls">
                    <button type="button" id="submitBtn" class="pure-button pure-button-primary">Submit</button>
                    <button type="button" class="pure-button" onclick="goBack()">Cancel</button>
                </div>
            </fieldset>
        </form>

        <!-- Hidden messages section -->
        <div id="messagesSection">
            <h2>Messages</h2>
            <table class="pure-table">
                <thead>
                    <tr>
                        <th>Username</th>
                        <th>Country</th>
                        <th>Date</th>
                        <th>Message</th>
                    </tr>
                </thead>
                <tbody id="ajaxMessageTable">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Store AJAX messages temporarily in memory
        let ajaxMessages = [];

        // Handle AJAX form submission
        document.getElementById('submitBtn').addEventListener('click', () => {
            const username = document.getElementById('username').value;
            const country = document.getElementById('country').value;
            const message = document.getElementById('message').value;

            fetch('/ajaxmessage', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, country, message }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Your message was sent via AJAX successfully!');

                    // Show the messages section
                    document.getElementById('messagesSection').style.display = 'block';

                    // Add the new message to the AJAX messages list
                    ajaxMessages.push({
                        username,
                        country,
                        date: new Date().toString(),
                        message
                    });

                    // Render the AJAX messages in the table
                    renderAjaxMessages();

                    // Clear the form fields
                    document.getElementById('username').value = '';
                    document.getElementById('country').value = '';
                    document.getElementById('message').value = '';
                }
            })
            .catch(console.error);
        });

        // Function to render AJAX messages
        function renderAjaxMessages() {
            const messageTableBody = document.querySelector('#ajaxMessageTable');
            messageTableBody.innerHTML = ''; // Clear existing messages

            ajaxMessages.forEach(msg => {
                const row = `<tr>
                    <td>${msg.username}</td>
                    <td>${msg.country}</td>
                    <td>${msg.date}</td>
                    <td>${msg.message}</td>
                </tr>`;
                messageTableBody.innerHTML += row; // Append each message
            });
        }

        // Function to go back to the previous page
        function goBack() {
            window.history.back();
        }
    </script>
</body>
</html>
